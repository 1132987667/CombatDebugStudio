{"version":3,"file":"GameSystem.es.js","sources":["../../src/utils/logger.ts","../../src/core/BuffScriptRegistry.ts","../../src/core/BuffContext.ts","../../src/core/ModifierStack.ts","../../src/core/BuffErrorBoundary.ts","../../src/core/BuffSystem.ts","../../src/core/BuffScriptLoader.ts","../../src/core/BattleAI.ts","../../src/core/BattleSystem.ts","../../src/utils/perf-monitor.ts","../../src/utils/object-pool.ts","../../src/utils/schema-validator.ts","../../src/scripts/base/BaseBuffScript.ts","../../src/scripts/base/BuffScriptUtils.ts","../../src/scripts/combat/MountainGodBuff.ts","../../src/scripts/combat/PoisonDebuff.ts","../../src/scripts/combat/BerserkBuff.ts","../../src/scripts/support/HealOverTime.ts","../../src/scripts/support/ShieldBuff.ts","../../src/scripts/index.ts","../../src/index.ts"],"sourcesContent":["export type LogLevel = 'DEBUG' | 'INFO' | 'WARN' | 'ERROR'\n\ninterface LoggerConfig {\n  level: LogLevel\n  prefix: string\n  enableColors: boolean\n}\n\nclass Logger {\n  private config: LoggerConfig\n\n  constructor(config: Partial<LoggerConfig> = {}) {\n    this.config = {\n      level: config.level || 'INFO',\n      prefix: config.prefix || 'BuffSystem',\n      enableColors: config.enableColors ?? true\n    }\n  }\n\n  private shouldLog(level: LogLevel): boolean {\n    const levels: LogLevel[] = ['DEBUG', 'INFO', 'WARN', 'ERROR']\n    return levels.indexOf(level) >= levels.indexOf(this.config.level)\n  }\n\n  private formatMessage(level: LogLevel, message: string, data?: any): string {\n    const timestamp = new Date().toISOString()\n    let formatted = `[${timestamp}] [${this.config.prefix}] [${level}] ${message}`\n\n    if (data) {\n      formatted += `\\n${JSON.stringify(data, null, 2)}`\n    }\n\n    return formatted\n  }\n\n  private log(level: LogLevel, message: string, data?: any): void {\n    if (!this.shouldLog(level)) return\n\n    const formatted = this.formatMessage(level, message, data)\n\n    switch (level) {\n      case 'DEBUG':\n        console.debug(formatted)\n        break\n      case 'INFO':\n        console.info(formatted)\n        break\n      case 'WARN':\n        console.warn(formatted)\n        break\n      case 'ERROR':\n        console.error(formatted)\n        break\n      default:\n        console.log(formatted)\n        break\n    }\n  }\n\n  public debug(message: string, data?: any): void {\n    this.log('DEBUG', message, data)\n  }\n\n  public info(message: string, data?: any): void {\n    this.log('INFO', message, data)\n  }\n\n  public warn(message: string, data?: any): void {\n    this.log('WARN', message, data)\n  }\n\n  public error(message: string, data?: any): void {\n    this.log('ERROR', message, data)\n  }\n\n  public setLevel(level: LogLevel): void {\n    this.config.level = level\n  }\n\n  public setPrefix(prefix: string): void {\n    this.config.prefix = prefix\n  }\n}\n\nexport const logger = new Logger()\nexport { Logger }\n","import { IBuffScript } from '@/types/buff';\r\nimport { Logger } from '@/utils/logger'; \r\n\r\ntype ScriptFactory<TParams = any> = () => IBuffScript<TParams>; \r\n\r\ninterface RegistryEntry<TParams = any> { \r\n  factory: ScriptFactory<TParams>; \r\n  metadata: { \r\n    scriptId: string; \r\n    filePath: string; \r\n    loadTime: number; \r\n    version?: string; \r\n  }; \r\n} \r\n\r\nexport class BuffScriptRegistry { \r\n  private static instance: BuffScriptRegistry;\r\n  private registry = new Map<string, RegistryEntry>();\r\n  private readonly logger = new Logger({ prefix: 'BuffScriptRegistry' });\r\n\r\n  private constructor() {} \r\n\r\n  public static getInstance(): BuffScriptRegistry { \r\n    if (!BuffScriptRegistry.instance) { \r\n      BuffScriptRegistry.instance = new BuffScriptRegistry(); \r\n    } \r\n    return BuffScriptRegistry.instance; \r\n  } \r\n\r\n  // 手动注册（推荐方式） \r\n  public register<TParams = any>(scriptId: string, factory: ScriptFactory<TParams>, metadata?: Partial<RegistryEntry['metadata']>): void { \r\n    if (this.registry.has(scriptId)) { \r\n      this.logger.warn(`Script \"${scriptId}\" already registered, overwriting`); \r\n    } \r\n\r\n    this.registry.set(scriptId, { \r\n      factory, \r\n      metadata: { \r\n        scriptId, \r\n        filePath: metadata?.filePath ?? 'unknown', \r\n        loadTime: Date.now(), \r\n        version: metadata?.version \r\n      } \r\n    }); \r\n\r\n    this.logger.info(`Registered buff script: ${scriptId}`); \r\n  } \r\n\r\n  // 安全获取（带类型推断） \r\n  public get<TParams = any>(scriptId: string): IBuffScript<TParams> | null { \r\n    const entry = this.registry.get(scriptId); \r\n    if (!entry) { \r\n      this.logger.error(`Buff script not found: ${scriptId}`); \r\n      return null; \r\n    } \r\n\r\n    try { \r\n      return entry.factory(); \r\n    } catch (e) { \r\n      this.logger.error(`Failed to instantiate script \"${scriptId}\":`, e); \r\n      return null; \r\n    } \r\n  } \r\n\r\n  // 批量注册（用于自动加载） \r\n  public batchRegister(entries: { scriptId: string; factory: ScriptFactory; filePath: string }[]): void { \r\n    entries.forEach(entry => { \r\n      this.register(entry.scriptId, entry.factory, { filePath: entry.filePath }); \r\n    }); \r\n  } \r\n\r\n  public has(scriptId: string): boolean { \r\n    return this.registry.has(scriptId); \r\n  } \r\n\r\n  public list(): string[] { \r\n    return Array.from(this.registry.keys()); \r\n  } \r\n\r\n  // 热重载支持：卸载旧版本 \r\n  public unregister(scriptId: string): boolean { \r\n    return this.registry.delete(scriptId); \r\n  } \r\n}","import type { BuffConfig } from '@/types/buff'\r\nimport type { Character } from '@/types/character'\r\nimport { BuffSystem } from './BuffSystem'\r\n\r\nexport class BuffContext {\r\n  public readonly characterId: string\r\n  public readonly instanceId: string\r\n  public readonly config: BuffConfig\r\n  public readonly startTime: number\r\n  public variables = new Map<string, any>()\r\n\r\n  constructor(\r\n    characterId: string,\r\n    instanceId: string,\r\n    config: BuffConfig\r\n  ) {\r\n    this.characterId = characterId\r\n    this.instanceId = instanceId\r\n    this.config = config\r\n    this.startTime = Date.now()\r\n  }\r\n\r\n  public getElapsedTime(): number {\r\n    return Date.now() - this.startTime\r\n  }\r\n\r\n  public getRemainingTime(): number {\r\n    if (this.config.duration <= 0) {\r\n      return -1\r\n    }\r\n    return Math.max(0, this.config.duration - this.getElapsedTime())\r\n  }\r\n\r\n  public setVariable(key: string, value: any): void {\r\n    this.variables.set(key, value)\r\n  }\r\n\r\n  public getVariable<T>(key: string): T | undefined {\r\n    return this.variables.get(key) as T\r\n  }\r\n\r\n  public removeVariable(key: string): void {\r\n    this.variables.delete(key)\r\n  }\r\n\r\n  public addModifier(\r\n    attribute: string,\r\n    value: number,\r\n    type: 'ADDITIVE' | 'MULTIPLICATIVE' | 'PERCENTAGE'\r\n  ): void {\r\n    const system = BuffSystem.getInstance()\r\n    const modifierStack = system.getModifierStack(this.characterId)\r\n    modifierStack.addModifier(\r\n      this.instanceId,\r\n      attribute as any,\r\n      value,\r\n      type\r\n    )\r\n  }\r\n\r\n  public removeModifiers(): void {\r\n    const system = BuffSystem.getInstance()\r\n    const modifierStack = system.getModifierStack(this.characterId)\r\n    modifierStack.removeModifier(this.instanceId)\r\n  }\r\n\r\n  public getCharacter(): Character | undefined {\r\n    // 这里应该从角色系统获取角色实例\r\n    // 暂时返回 undefined，实际实现需要集成角色系统\r\n    return undefined\r\n  }\r\n\r\n  public getAttributeValue(attribute: string): number {\r\n    const character = this.getCharacter()\r\n    if (character) {\r\n      return character.getAttribute(attribute as any)\r\n    }\r\n    return 0\r\n  }\r\n\r\n  public triggerEvent(eventName: string, data?: any): void {\r\n    // 这里应该触发游戏事件系统\r\n    console.log(`Buff event triggered: ${eventName}`, data)\r\n  }\r\n}\r\n","import type { Modifier, ModifierType, AttributeType } from '@/types/modifier'\r\n\r\nexport class ModifierStack {\r\n  private modifiers = new Map<string, Modifier[]>()\r\n\r\n  public addModifier(\r\n    buffInstanceId: string,\r\n    attribute: AttributeType,\r\n    value: number,\r\n    type: ModifierType\r\n  ): void {\r\n    const key = attribute\r\n    if (!this.modifiers.has(key)) {\r\n      this.modifiers.set(key, [])\r\n    }\r\n\r\n    const stack = this.modifiers.get(key)!\r\n    stack.push({\r\n      buffInstanceId,\r\n      attribute,\r\n      value,\r\n      type\r\n    })\r\n  }\r\n\r\n  public removeModifier(buffInstanceId: string): void {\r\n    for (const [key, stack] of this.modifiers.entries()) {\r\n      const filtered = stack.filter(\r\n        (modifier) => modifier.buffInstanceId !== buffInstanceId\r\n      )\r\n      if (filtered.length === 0) {\r\n        this.modifiers.delete(key)\r\n      } else {\r\n        this.modifiers.set(key, filtered)\r\n      }\r\n    }\r\n  }\r\n\r\n  public calculate(attribute: AttributeType, baseValue: number): number {\r\n    const modifiers = this.modifiers.get(attribute)\r\n    if (!modifiers || modifiers.length === 0) {\r\n      return baseValue\r\n    }\r\n\r\n    let result = baseValue\r\n    let additiveSum = 0\r\n    let multiplicativeSum = 1\r\n\r\n    for (const modifier of modifiers) {\r\n      switch (modifier.type) {\r\n        case 'ADDITIVE':\r\n          additiveSum += modifier.value\r\n          break\r\n        case 'MULTIPLICATIVE':\r\n          multiplicativeSum *= (1 + modifier.value)\r\n          break\r\n        case 'PERCENTAGE':\r\n          additiveSum += baseValue * modifier.value\r\n          break\r\n        default:\r\n          break\r\n      }\r\n    }\r\n\r\n    result += additiveSum\r\n    result *= multiplicativeSum\r\n\r\n    return result\r\n  }\r\n\r\n  public getModifiers(attribute?: AttributeType): Modifier[] {\r\n    if (attribute) {\r\n      return this.modifiers.get(attribute) || []\r\n    }\r\n\r\n    const allModifiers: Modifier[] = []\r\n    for (const stack of this.modifiers.values()) {\r\n      allModifiers.push(...stack)\r\n    }\r\n    return allModifiers\r\n  }\r\n\r\n  public clear(): void {\r\n    this.modifiers.clear()\r\n  }\r\n\r\n  public getModifierCount(): number {\r\n    let count = 0\r\n    for (const stack of this.modifiers.values()) {\r\n      count += stack.length\r\n    }\r\n    return count\r\n  }\r\n}","import { logger } from '@/utils/logger'\r\n\r\nexport class BuffErrorBoundary {\r\n  public static wrap<T>(fn: () => T): T | null {\r\n    try {\r\n      return fn()\r\n    } catch (error) {\r\n      BuffErrorBoundary.handleError(error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  public static wrapAsync<T>(fn: () => Promise<T>): Promise<T | null> {\r\n    return fn().catch((error) => {\r\n      BuffErrorBoundary.handleError(error)\r\n      return null\r\n    })\r\n  }\r\n\r\n  private static handleError(error: unknown): void {\r\n    if (error instanceof Error) {\r\n      logger.error('Buff script error:', {\r\n        message: error.message,\r\n        stack: error.stack\r\n      })\r\n    } else {\r\n      logger.error('Unknown buff script error:', error)\r\n    }\r\n  }\r\n\r\n  public static executeWithRetry<T>(\r\n    fn: () => T,\r\n    maxRetries: number = 3\r\n  ): T | null {\r\n    let retries = 0\r\n\r\n    while (retries < maxRetries) {\r\n      try {\r\n        return fn()\r\n      } catch (error) {\r\n        retries++\r\n        if (retries >= maxRetries) {\r\n          BuffErrorBoundary.handleError(error)\r\n          return null\r\n        }\r\n        logger.warn(`Retrying buff script execution (${retries}/${maxRetries})`)\r\n      }\r\n    }\r\n\r\n    return null\r\n  }\r\n}","import { reactive } from 'vue'\r\nimport type { BuffConfig, BuffInstance } from '@/types/buff'\r\nimport { BuffScriptRegistry } from './BuffScriptRegistry'\r\nimport { BuffContext } from './BuffContext'\r\nimport { ModifierStack } from './ModifierStack'\r\nimport { BuffErrorBoundary } from './BuffErrorBoundary'\r\n\r\nexport class BuffSystem {\r\n  private static instance: BuffSystem\r\n  private buffInstances = reactive<Map<string, BuffInstance>>(\r\n    new Map()\r\n  )\r\n  private modifierStacks = reactive<Map<string, ModifierStack>>(\r\n    new Map()\r\n  )\r\n\r\n  private constructor() {}\r\n\r\n  public static getInstance(): BuffSystem {\r\n    if (!BuffSystem.instance) {\r\n      BuffSystem.instance = new BuffSystem()\r\n    }\r\n    return BuffSystem.instance\r\n  }\r\n\r\n  public addBuff(\r\n    characterId: string,\r\n    buffId: string,\r\n    config: BuffConfig\r\n  ): string {\r\n    const script = BuffScriptRegistry.getInstance().get(buffId)\r\n    if (!script) {\r\n      throw new Error(`Buff script ${buffId} not found`)\r\n    }\r\n\r\n    const instanceId = `${characterId}_${buffId}_${Date.now()}`\r\n    const context = new BuffContext(characterId, instanceId, config)\r\n    \r\n    const buffInstance: BuffInstance = {\r\n      id: instanceId,\r\n      characterId,\r\n      buffId,\r\n      script,\r\n      context,\r\n      startTime: Date.now(),\r\n      duration: config.duration || -1,\r\n      isActive: true\r\n    }\r\n\r\n    this.buffInstances.set(instanceId, buffInstance)\r\n    \r\n    if (!this.modifierStacks.has(characterId)) {\r\n      this.modifierStacks.set(characterId, new ModifierStack())\r\n    }\r\n\r\n    BuffErrorBoundary.wrap(() => {\r\n      script.onApply(context)\r\n    })\r\n\r\n    return instanceId\r\n  }\r\n\r\n  public removeBuff(instanceId: string): boolean {\r\n    const instance = this.buffInstances.get(instanceId)\r\n    if (!instance || !instance.isActive) {\r\n      return false\r\n    }\r\n\r\n    BuffErrorBoundary.wrap(() => {\r\n      instance.script.onRemove(instance.context)\r\n    })\r\n\r\n    instance.isActive = false\r\n    this.buffInstances.delete(instanceId)\r\n\r\n    return true\r\n  }\r\n\r\n  public refreshBuff(instanceId: string): boolean {\r\n    const instance = this.buffInstances.get(instanceId)\r\n    if (!instance || !instance.isActive) {\r\n      return false\r\n    }\r\n\r\n    BuffErrorBoundary.wrap(() => {\r\n      instance.script.onRefresh(instance.context)\r\n    })\r\n\r\n    instance.startTime = Date.now()\r\n    return true\r\n  }\r\n\r\n  public update(deltaTime: number): void {\r\n    const toRemove: string[] = []\r\n\r\n    this.buffInstances.forEach((instance) => {\r\n      if (!instance.isActive) return\r\n\r\n      BuffErrorBoundary.wrap(() => {\r\n        instance.script.onUpdate(instance.context, deltaTime)\r\n      })\r\n\r\n      if (instance.duration > 0 && Date.now() - instance.startTime >= instance.duration) {\r\n        toRemove.push(instance.id)\r\n      }\r\n    })\r\n\r\n    toRemove.forEach((instanceId) => this.removeBuff(instanceId))\r\n  }\r\n\r\n  public getBuffInstances(characterId: string): BuffInstance[] {\r\n    const instances: BuffInstance[] = []\r\n    this.buffInstances.forEach((instance) => {\r\n      if (instance.characterId === characterId && instance.isActive) {\r\n        instances.push(instance)\r\n      }\r\n    })\r\n    return instances\r\n  }\r\n\r\n  public getModifierStack(characterId: string): ModifierStack {\r\n    if (!this.modifierStacks.has(characterId)) {\r\n      this.modifierStacks.set(characterId, new ModifierStack())\r\n    }\r\n    return this.modifierStacks.get(characterId) as ModifierStack  \r\n  }\r\n\r\n  public clearAllBuffs(characterId: string): void {\r\n    const toRemove: string[] = []\r\n    this.buffInstances.forEach((instance) => {\r\n      if (instance.characterId === characterId) {\r\n        toRemove.push(instance.id)\r\n      }\r\n    })\r\n    toRemove.forEach((instanceId) => this.removeBuff(instanceId))\r\n    this.modifierStacks.delete(characterId)\r\n  }\r\n}","import { BuffScriptRegistry } from './BuffScriptRegistry'\r\n\r\nexport class BuffScriptLoader {\r\n  private static instance: BuffScriptLoader\r\n  private loadedScripts = new Set<string>()\r\n\r\n  private constructor() {}\r\n\r\n  public static getInstance(): BuffScriptLoader {\r\n    if (!BuffScriptLoader.instance) {\r\n      BuffScriptLoader.instance = new BuffScriptLoader()\r\n    }\r\n    return BuffScriptLoader.instance\r\n  }\r\n\r\n  public async loadScripts(): Promise<void> {\r\n    try {\r\n      // 手动导入已知的脚本\r\n      // 注意：在实际项目中，这里可以使用 Vite 的 glob 导入\r\n      // 但为了类型安全，我们暂时使用手动导入\r\n      const { MountainGodBuff } = await import('@/scripts/combat/MountainGodBuff')\r\n      const { PoisonDebuff } = await import('@/scripts/combat/PoisonDebuff')\r\n      const { BerserkBuff } = await import('@/scripts/combat/BerserkBuff')\r\n      const { HealOverTime } = await import('@/scripts/support/HealOverTime')\r\n      const { ShieldBuff } = await import('@/scripts/support/ShieldBuff')\r\n\r\n      // 注册脚本\r\n      const registry = BuffScriptRegistry.getInstance()\r\n      \r\n      if (MountainGodBuff.BUFF_ID) {\r\n        registry.register(MountainGodBuff.BUFF_ID, () => new MountainGodBuff(), { \r\n          filePath: '@/scripts/combat/MountainGodBuff'\r\n        })\r\n        this.loadedScripts.add('MountainGodBuff')\r\n      }\r\n      \r\n      if (PoisonDebuff.BUFF_ID) {\r\n        registry.register(PoisonDebuff.BUFF_ID, () => new PoisonDebuff(), { \r\n          filePath: '@/scripts/combat/PoisonDebuff'\r\n        })\r\n        this.loadedScripts.add('PoisonDebuff')\r\n      }\r\n      \r\n      if (BerserkBuff.BUFF_ID) {\r\n        registry.register(BerserkBuff.BUFF_ID, () => new BerserkBuff(), { \r\n          filePath: '@/scripts/combat/BerserkBuff'\r\n        })\r\n        this.loadedScripts.add('BerserkBuff')\r\n      }\r\n      \r\n      if (HealOverTime.BUFF_ID) {\r\n        registry.register(HealOverTime.BUFF_ID, () => new HealOverTime(), { \r\n          filePath: '@/scripts/support/HealOverTime'\r\n        })\r\n        this.loadedScripts.add('HealOverTime')\r\n      }\r\n      \r\n      if (ShieldBuff.BUFF_ID) {\r\n        registry.register(ShieldBuff.BUFF_ID, () => new ShieldBuff(), { \r\n          filePath: '@/scripts/support/ShieldBuff'\r\n        })\r\n        this.loadedScripts.add('ShieldBuff')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load buff scripts:', error)\r\n    }\r\n  }\r\n\r\n  public async reloadScripts(): Promise<void> {\r\n    // 清空已加载的脚本\r\n    this.loadedScripts.clear()\r\n    // 使用批量卸载而不是清空整个注册表\r\n    const registry = BuffScriptRegistry.getInstance()\r\n    const scriptIds = registry.list()\r\n    scriptIds.forEach(id => registry.unregister(id))\r\n    await this.loadScripts()\r\n  }\r\n\r\n  public getLoadedScriptCount(): number {\r\n    return this.loadedScripts.size\r\n  }\r\n\r\n  public clear(): void {\r\n    this.loadedScripts.clear()\r\n    // 使用批量卸载而不是清空整个注册表\r\n    const registry = BuffScriptRegistry.getInstance()\r\n    const scriptIds = registry.list()\r\n    scriptIds.forEach(id => registry.unregister(id))\r\n  }\r\n}","import type {\n  BattleParticipant,\n  BattleAction,\n  BattleState,\n} from '@/types/battle'\nimport { logger } from '@/utils/logger'\n\n// 战斗AI接口\nexport interface BattleAI {\n  /**\n   * 做出战斗决策\n   */\n  makeDecision(\n    battleState: BattleState,\n    participant: BattleParticipant,\n  ): BattleAction\n\n  /**\n   * 选择目标\n   */\n  selectTarget(battleState: BattleState, participant: BattleParticipant): string\n\n  /**\n   * 检查是否应该使用技能\n   */\n  shouldUseSkill(participant: BattleParticipant): boolean\n\n  /**\n   * 选择技能\n   */\n  selectSkill(participant: BattleParticipant): string | null\n\n  /**\n   * 选择攻击\n   */\n  selectAttack(participant: BattleParticipant): BattleAction\n}\n\n// 技能类型\nexport enum SkillType {\n  PASSIVE = 'passive',\n  SMALL = 'small',\n  ULTIMATE = 'ultimate',\n}\n\n// 技能定义\nexport interface Skill {\n  id: string\n  name: string\n  type: SkillType\n  energyCost: number\n  cooldown: number\n  lastUsed: number\n  description: string\n  damage?: number\n  heal?: number\n  buffId?: string\n}\n\n// 战场分析结果\ninterface BattleAnalysis {\n  allies: BattleParticipant[]\n  enemies: BattleParticipant[]\n  teamHealthPercent: number\n  highestThreatEnemy: { enemy: BattleParticipant | null; threat: number }\n  needsHealing: boolean\n  shouldUseSkill: boolean\n}\n\n// 基础AI策略\nexport class BaseBattleAI implements BattleAI {\n  protected skills: Map<string, Skill> = new Map()\n\n  constructor() {\n    this.initializeSkills()\n  }\n\n  protected initializeSkills(): void {\n    // 子类实现\n  }\n\n  public makeDecision(\n    battleState: BattleState,\n    participant: BattleParticipant,\n  ): BattleAction {\n    try {\n      // 验证参数\n      if (!battleState || !participant) {\n        logger.error('AI决策参数无效:', { battleState, participant })\n        return this.selectAttack(participant)\n      }\n\n      // 分析战场态势\n      const battleAnalysis = this.analyzeBattleState(battleState, participant)\n\n      // 基于战场分析做出决策\n      if (battleAnalysis.shouldUseSkill) {\n        const skillId = this.selectSkill(participant, battleAnalysis)\n        if (skillId) {\n          try {\n            return this.createSkillAction(battleState, participant, skillId)\n          } catch (skillError) {\n            logger.error('技能执行出错:', skillError)\n            return this.selectAttack(participant)\n          }\n        }\n      }\n\n      // 默认使用攻击\n      return this.selectAttack(participant)\n    } catch (error) {\n      logger.error('AI决策出错:', error)\n      try {\n        return this.selectAttack(participant)\n      } catch (attackError) {\n        logger.error('攻击执行出错:', attackError)\n        // 返回一个安全的默认行动\n        return {\n          id: `fallback_${Date.now()}`,\n          type: 'attack',\n          sourceId: participant?.id || 'unknown',\n          targetId: 'unknown',\n          damage: 10,\n          success: true,\n          timestamp: Date.now(),\n          effects: [\n            {\n              type: 'damage',\n              value: 10,\n              description: '默认攻击',\n            },\n          ],\n        }\n      }\n    }\n  }\n\n  /**\n   * 分析战场态势\n   */\n  protected analyzeBattleState(\n    battleState: BattleState,\n    participant: BattleParticipant,\n  ): BattleAnalysis {\n    const allies = Array.from(battleState.participants.values()).filter(\n      (p) => p.type === participant.type && p.isAlive(),\n    )\n\n    const enemies = Array.from(battleState.participants.values()).filter(\n      (p) => p.type !== participant.type && p.isAlive(),\n    )\n\n    // 计算团队血量\n    const teamHealth = allies.reduce((sum, p) => sum + p.currentHealth, 0)\n    const teamMaxHealth = allies.reduce((sum, p) => sum + p.maxHealth, 0)\n    const teamHealthPercent = teamMaxHealth > 0 ? teamHealth / teamMaxHealth : 0\n\n    // 计算敌人威胁\n    const highestThreatEnemy = enemies.reduce<{\n      enemy: BattleParticipant | null\n      threat: number\n    }>(\n      (max, enemy) => {\n        const threat = this.calculateThreat(enemy, participant, battleState)\n        return threat > max.threat ? { enemy, threat } : max\n      },\n      { enemy: null, threat: 0 },\n    )\n\n    // 检查是否有需要治疗的队友\n    const needsHealing = allies.some((p) => p.currentHealth / p.maxHealth < 0.3)\n\n    return {\n      allies,\n      enemies,\n      teamHealthPercent,\n      highestThreatEnemy,\n      needsHealing,\n      shouldUseSkill: this.shouldUseSkill(participant),\n    }\n  }\n\n  public selectTarget(\n    battleState: BattleState,\n    _participant: BattleParticipant,\n  ): string {\n    const enemies = Array.from(battleState.participants.values())\n      .filter((p) => p.type !== _participant.type && p.isAlive())\n      .map((p) => p)\n\n    if (enemies.length === 0) {\n      throw new Error('No valid targets')\n    }\n\n    // 基于威胁值排序选择目标\n    const targetsWithThreat = enemies.map((target) => ({\n      target,\n      threat: this.calculateThreat(target, _participant, battleState),\n    }))\n\n    // 按威胁值排序\n    targetsWithThreat.sort((a, b) => b.threat - a.threat)\n\n    return targetsWithThreat[0].target.id\n  }\n\n  /**\n   * 计算目标的威胁值\n   */\n  protected calculateThreat(\n    target: BattleParticipant,\n    participant: BattleParticipant,\n    _battleState: BattleState,\n  ): number {\n    let threat = 0\n\n    // 基于血量\n    const healthPercent = target.currentHealth / target.maxHealth\n    threat += (1 - healthPercent) * 50 // 血量越低威胁越高\n\n    // 基于能量\n    const energyPercent = target.currentEnergy / target.maxEnergy\n    threat += energyPercent * 30 // 能量越高威胁越高\n\n    // 基于类型\n    if (target.type === 'character' && participant.type === 'enemy') {\n      threat += 20 // 敌人优先攻击角色\n    }\n\n    // 基于状态效果\n    if (target.buffs.length > 0) {\n      threat += target.buffs.length * 10 // 有buff的目标威胁更高\n    }\n\n    return threat\n  }\n\n  public shouldUseSkill(participant: BattleParticipant): boolean {\n    // 检查能量是否足够\n    const energy =\n      participant.getAttribute('energy') || participant.currentEnergy || 0\n    const maxEnergy =\n      participant.getAttribute('max_energy') || participant.maxEnergy || 150\n\n    // 能量达到70%以上考虑使用技能\n    return energy >= maxEnergy * 0.7\n  }\n\n  public selectSkill(\n    _participant: BattleParticipant,\n    analysis?: BattleAnalysis,\n  ): string | null {\n    // 简单的技能选择逻辑\n    const skills = Array.from(this.skills.values())\n    if (skills.length === 0) {\n      return null\n    }\n\n    // 基于战场分析的技能选择\n    if (analysis) {\n      // 优先选择治疗技能如果团队需要治疗\n      if (analysis.needsHealing) {\n        const healSkill = skills.find((s) => s.heal && s.heal > 0)\n        if (healSkill) {\n          return healSkill.id\n        }\n      }\n\n      // 如果敌人威胁很高，优先选择高伤害技能\n      if (analysis.highestThreatEnemy.threat > 50) {\n        const damageSkill = skills.find((s) => s.damage && s.damage > 0)\n        if (damageSkill) {\n          return damageSkill.id\n        }\n      }\n    }\n\n    // 优先选择小技能\n    const smallSkill = skills.find((s) => s.type === SkillType.SMALL)\n    if (smallSkill) {\n      return smallSkill.id\n    }\n\n    // 其次选择大招\n    const ultimateSkill = skills.find((s) => s.type === SkillType.ULTIMATE)\n    if (ultimateSkill) {\n      return ultimateSkill.id\n    }\n\n    return null\n  }\n\n  public selectAttack(participant: BattleParticipant): BattleAction {\n    return {\n      id: `attack_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      type: 'attack',\n      sourceId: participant.id,\n      targetId: '', // 会在makeDecision中设置\n      damage: Math.floor(Math.random() * 20) + 10,\n      success: true,\n      timestamp: Date.now(),\n      effects: [\n        {\n          type: 'damage',\n          value: Math.floor(Math.random() * 20) + 10,\n          description: `${participant.name} 普通攻击`,\n        },\n      ],\n    }\n  }\n\n  /**\n   * 选择治疗目标\n   */\n  protected selectHealTarget(\n    battleState: BattleState,\n    participant: BattleParticipant,\n  ): string {\n    // 收集所有友方目标\n    const allies: { target: BattleParticipant; healthPercent: number }[] = []\n\n    battleState.participants.forEach((target) => {\n      // 只选择同类型的目标（角色选择角色，敌人选择敌人）\n      if (target.type === participant.type && target.isAlive()) {\n        const healthPercent = target.currentHealth / target.maxHealth\n        allies.push({ target, healthPercent })\n      }\n    })\n\n    // 按血量百分比排序，优先选择血量低的目标\n    allies.sort((a, b) => a.healthPercent - b.healthPercent)\n\n    // 返回血量最低的友方目标\n    return allies.length > 0 ? allies[0].target.id : participant.id\n  }\n\n  protected createSkillAction(\n    battleState: BattleState,\n    participant: BattleParticipant,\n    skillId: string,\n  ): BattleAction {\n    const skill = this.skills.get(skillId)\n\n    if (!skill) {\n      throw new Error(`Skill not found: ${skillId}`)\n    }\n\n    // 根据技能类型选择目标\n    let targetId = ''\n    if (skill.heal) {\n      // 治疗技能选择友方目标\n      targetId = this.selectHealTarget(battleState, participant)\n    } else {\n      // 其他技能选择敌方目标\n      targetId = this.selectTarget(battleState, participant)\n    }\n\n    const action: BattleAction = {\n      id: `skill_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      type: 'skill',\n      sourceId: participant.id,\n      targetId,\n      skillId,\n      success: true,\n      timestamp: Date.now(),\n      effects: [\n        {\n          type: 'status',\n          description: `${participant.name} 使用 ${skill.name}`,\n        },\n      ],\n    }\n\n    // 添加技能效果\n    if (skill.damage) {\n      action.damage = skill.damage\n      action.effects.push({\n        type: 'damage',\n        value: skill.damage,\n        description: `造成 ${skill.damage} 伤害`,\n      })\n    }\n\n    if (skill.heal) {\n      action.heal = skill.heal\n      action.effects.push({\n        type: 'heal',\n        value: skill.heal,\n        description: `恢复 ${skill.heal} 生命值`,\n      })\n    }\n\n    if (skill.buffId) {\n      action.buffId = skill.buffId\n      action.effects.push({\n        type: 'buff',\n        buffId: skill.buffId,\n        description: `施加 ${skill.name} 效果`,\n      })\n    }\n\n    return action\n  }\n\n  /**\n   * 添加技能\n   */\n  public addSkill(skill: Skill): void {\n    this.skills.set(skill.id, skill)\n  }\n\n  /**\n   * 获取技能\n   */\n  public getSkill(skillId: string): Skill | undefined {\n    return this.skills.get(skillId)\n  }\n\n  /**\n   * 获取所有技能\n   */\n  public getSkills(): Skill[] {\n    return Array.from(this.skills.values())\n  }\n}\n\n// 角色AI\nexport class CharacterAI extends BaseBattleAI {\n  protected initializeSkills(): void {\n    // 默认角色技能\n    this.addSkill({\n      id: 'skill_heal',\n      name: '治疗术',\n      type: SkillType.SMALL,\n      energyCost: 30,\n      cooldown: 2000,\n      lastUsed: 0,\n      description: '恢复生命值',\n      heal: 50,\n    })\n\n    this.addSkill({\n      id: 'skill_attack',\n      name: '强力攻击',\n      type: SkillType.SMALL,\n      energyCost: 25,\n      cooldown: 1500,\n      lastUsed: 0,\n      description: '造成额外伤害',\n      damage: 35,\n    })\n\n    this.addSkill({\n      id: 'skill_ultimate',\n      name: '终极技能',\n      type: SkillType.ULTIMATE,\n      energyCost: 100,\n      cooldown: 5000,\n      lastUsed: 0,\n      description: '造成大量伤害',\n      damage: 80,\n    })\n  }\n\n  public shouldUseSkill(participant: BattleParticipant): boolean {\n    // 角色特有逻辑\n    const healthPercent = participant.currentHealth / participant.maxHealth\n\n    // 血量低于50%时优先治疗\n    if (healthPercent < 0.5) {\n      return true\n    }\n\n    return super.shouldUseSkill(participant)\n  }\n\n  public selectSkill(\n    participant: BattleParticipant,\n    analysis?: BattleAnalysis,\n  ): string | null {\n    const healthPercent = participant.currentHealth / participant.maxHealth\n\n    // 血量低时优先使用治疗技能\n    if (healthPercent < 0.5) {\n      const healSkill = Array.from(this.skills.values()).find(\n        (s) => s.heal && s.heal > 0,\n      )\n      if (healSkill) {\n        return healSkill.id\n      }\n    }\n\n    // 满血时不使用治疗技能\n    const healSkill = Array.from(this.skills.values()).find(\n      (s) => s.heal && s.heal > 0,\n    )\n    if (healSkill && healthPercent >= 1) {\n      // 满血，跳过治疗技能，选择其他技能\n      const attackSkills = Array.from(this.skills.values()).filter(\n        (s) => s.damage && s.damage > 0,\n      )\n      if (attackSkills.length > 0) {\n        // 优先选择伤害最高的技能\n        attackSkills.sort((a, b) => (b.damage || 0) - (a.damage || 0))\n        return attackSkills[0].id\n      }\n    }\n\n    // 能量足够时优先使用大招\n    if (participant.currentEnergy >= 100) {\n      const ultimateSkill = Array.from(this.skills.values()).find(\n        (s) => s.type === SkillType.ULTIMATE,\n      )\n      if (ultimateSkill) {\n        return ultimateSkill.id\n      }\n    }\n\n    return super.selectSkill(participant, analysis)\n  }\n\n  public selectTarget(\n    battleState: BattleState,\n    _participant: BattleParticipant,\n  ): string {\n    const enemies = Array.from(battleState.participants.values())\n      .filter((p) => p.type === 'enemy' && p.isAlive())\n      .map((p) => p)\n\n    if (enemies.length === 0) {\n      throw new Error('No enemies found')\n    }\n\n    // 优先攻击血量最低的敌人\n    enemies.sort((a, b) => a.currentHealth - b.currentHealth)\n    return enemies[0].id\n  }\n}\n\n// 敌人AI\nexport class EnemyAI extends BaseBattleAI {\n  protected initializeSkills(): void {\n    // 默认敌人技能\n    this.addSkill({\n      id: 'enemy_skill_1',\n      name: '爪击',\n      type: SkillType.SMALL,\n      energyCost: 20,\n      cooldown: 1000,\n      lastUsed: 0,\n      description: '快速攻击',\n      damage: 25,\n    })\n\n    this.addSkill({\n      id: 'enemy_skill_2',\n      name: '狂暴',\n      type: SkillType.ULTIMATE,\n      energyCost: 80,\n      cooldown: 3000,\n      lastUsed: 0,\n      description: '增加攻击力',\n      damage: 60,\n    })\n  }\n\n  public shouldUseSkill(participant: BattleParticipant): boolean {\n    // 敌人更激进\n    return participant.currentEnergy >= 50\n  }\n\n  public selectSkill(\n    participant: BattleParticipant,\n    analysis?: BattleAnalysis,\n  ): string | null {\n    return super.selectSkill(participant, analysis)\n  }\n\n  public selectTarget(\n    battleState: BattleState,\n    _participant: BattleParticipant,\n  ): string {\n    const characters = Array.from(battleState.participants.values())\n      .filter((p) => p.type === 'character' && p.isAlive())\n      .map((p) => p)\n\n    if (characters.length === 0) {\n      throw new Error('No characters found')\n    }\n\n    // 优先攻击血量最低的角色\n    characters.sort((a, b) => a.currentHealth - b.currentHealth)\n    return characters[0].id\n  }\n}\n\n// AI工厂\nexport class BattleAIFactory {\n  public static createAI(type: 'character' | 'enemy'): BattleAI {\n    return type === 'character' ? new CharacterAI() : new EnemyAI()\n  }\n}\n","import type {\n  BattleSystem as IBattleSystem,\n  BattleState,\n  BattleAction,\n  BattleParticipant,\n  BattleEntityType,\n  BattleCharacter,\n  BattleEnemy,\n} from '@/types/battle'\nimport type { Character } from '@/types/character'\nimport type { EnemyInstance } from '@/types/enemy'\nimport type { AttributeType } from '@/types/modifier'\nimport { logger } from '@/utils/logger'\nimport { BattleAIFactory, BattleAI } from '@/core/BattleAI'\n\ninterface ParticipantInfo {\n  id: string\n  name: string\n  type: 'character' | 'enemy'\n  maxHealth: number\n  currentHealth: number\n  maxEnergy: number\n  currentEnergy: number\n}\n\ninterface BattleData {\n  battleId: string\n  participants: Map<string, BattleParticipant>\n  actions: BattleAction[]\n  turnOrder: string[]\n  currentTurn: number\n  isActive: boolean\n  startTime: number\n  endTime?: number\n  winner?: BattleEntityType\n  aiInstances: Map<string, BattleAI> // 每个参与者的AI实例\n}\n\nabstract class BaseBattleParticipant {\n  id: string\n  name: string\n  level: number\n  currentHealth: number\n  maxHealth: number\n  currentEnergy: number\n  maxEnergy: number\n  buffs: string[]\n  skills: Map<string, any> = new Map()\n\n  constructor(data: {\n    id: string\n    name: string\n    level: number\n    currentHealth: number\n    maxHealth: number\n    currentEnergy?: number\n    maxEnergy?: number\n    buffs?: string[]\n    skills?: any[]\n  }) {\n    this.id = data.id\n    this.name = data.name\n    this.level = data.level\n    this.currentHealth = data.currentHealth\n    this.maxHealth = data.maxHealth\n    this.currentEnergy = data.currentEnergy || 0\n    this.maxEnergy = data.maxEnergy || 150\n    this.buffs = data.buffs || []\n\n    // 初始化技能\n    if (data.skills) {\n      data.skills.forEach((skill) => {\n        this.skills.set(skill.id, skill)\n      })\n    }\n  }\n\n  abstract get type(): BattleEntityType\n\n  getAttribute(attribute: string): number {\n    // Simplified attribute system - in real implementation, this would use the actual attribute system\n    switch (attribute) {\n      case 'HP':\n        return this.currentHealth\n      case 'MAX_HP':\n        return this.maxHealth\n      case 'ATK':\n        return this.level * 5 // Simplified attack calculation\n      case 'DEF':\n        return this.level * 2 // Simplified defense calculation\n      case 'energy':\n        return this.currentEnergy\n      case 'max_energy':\n        return this.maxEnergy\n      default:\n        return 0\n    }\n  }\n\n  setAttribute(attribute: string, value: number): void {\n    if (attribute === 'HP') {\n      this.currentHealth = Math.max(0, Math.min(value, this.maxHealth))\n    } else if (attribute === 'energy') {\n      this.currentEnergy = Math.max(0, Math.min(value, this.maxEnergy))\n    }\n    // Other attributes would be handled in a real implementation\n  }\n\n  addBuff(buffInstanceId: string): void {\n    if (!this.buffs.includes(buffInstanceId)) {\n      this.buffs.push(buffInstanceId)\n    }\n  }\n\n  removeBuff(buffInstanceId: string): void {\n    this.buffs = this.buffs.filter((id) => id !== buffInstanceId)\n  }\n\n  hasBuff(buffId: string): boolean {\n    return this.buffs.some((id) => id.includes(buffId))\n  }\n\n  takeDamage(amount: number): number {\n    const damage = Math.max(0, amount)\n    this.currentHealth = Math.max(0, this.currentHealth - damage)\n    // 受到攻击获得15能量\n    this.gainEnergy(15)\n    return damage\n  }\n\n  heal(amount: number): number {\n    const healAmount = Math.max(0, amount)\n    const originalHealth = this.currentHealth\n    this.currentHealth = Math.min(\n      this.currentHealth + healAmount,\n      this.maxHealth,\n    )\n    return this.currentHealth - originalHealth\n  }\n\n  gainEnergy(amount: number): void {\n    this.currentEnergy = Math.min(this.currentEnergy + amount, this.maxEnergy)\n  }\n\n  spendEnergy(amount: number): boolean {\n    if (this.currentEnergy >= amount) {\n      this.currentEnergy -= amount\n      return true\n    }\n    return false\n  }\n\n  isAlive(): boolean {\n    return this.currentHealth > 0\n  }\n\n  // 技能管理\n  addSkill(skill: any): void {\n    this.skills.set(skill.id, skill)\n  }\n\n  getSkill(skillId: string): any {\n    return this.skills.get(skillId)\n  }\n\n  getSkills(): any[] {\n    return Array.from(this.skills.values())\n  }\n\n  hasSkill(skillId: string): boolean {\n    return this.skills.has(skillId)\n  }\n\n  // 行动后处理\n  afterAction(): void {\n    // 每次行动后获得能量\n    this.gainEnergy(10)\n  }\n\n  // 检查是否满血\n  isFullHealth(): boolean {\n    return this.currentHealth >= this.maxHealth\n  }\n\n  // 检查是否需要治疗\n  needsHealing(): boolean {\n    return this.currentHealth / this.maxHealth < 0.5\n  }\n}\n\nclass SimpleBattleCharacter\n  extends BaseBattleParticipant\n  implements BattleCharacter\n{\n  type = 'character' as const\n  character: Character\n\n  constructor(data: {\n    id: string\n    name: string\n    level: number\n    currentHealth: number\n    maxHealth: number\n    buffs?: string[]\n    character?: Character\n  }) {\n    super(data)\n    this.character = data.character || this.createDefaultCharacter(data)\n  }\n\n  private createDefaultCharacter(data: {\n    id: string\n    name: string\n    level: number\n  }): Character {\n    const attributes: Record<AttributeType, number> = {\n      HP: data.level * 10,\n      MP: data.level * 5,\n      ATK: data.level * 2,\n      DEF: data.level,\n      SPD: data.level,\n      CRIT_RATE: 0.05,\n      CRIT_DMG: 1.5,\n      ACCURACY: 0.9,\n      EVADE: 0.1,\n      LIFESTEAL: 0,\n      REGENERATION: 0,\n      MANA_REGEN: 0,\n      DAMAGE_BOOST: 0,\n      DAMAGE_REDUCE: 0,\n    }\n\n    const buffs: string[] = []\n\n    return {\n      id: data.id,\n      name: data.name,\n      level: data.level,\n      attributes,\n      buffs,\n      getAttribute: (attribute: AttributeType) => attributes[attribute] || 0,\n      setAttribute: (attribute: AttributeType, value: number) => {\n        attributes[attribute] = value\n      },\n      addBuff: (buffInstanceId: string) => {\n        if (!buffs.includes(buffInstanceId)) {\n          buffs.push(buffInstanceId)\n        }\n      },\n      removeBuff: (buffInstanceId: string) => {\n        const index = buffs.indexOf(buffInstanceId)\n        if (index !== -1) {\n          buffs.splice(index, 1)\n        }\n      },\n      hasBuff: (buffId: string) => buffs.some((id) => id.includes(buffId)),\n    }\n  }\n}\n\nclass SimpleBattleEnemy extends BaseBattleParticipant implements BattleEnemy {\n  type = 'enemy' as const\n  enemy: EnemyInstance\n\n  constructor(data: {\n    id: string\n    name: string\n    level: number\n    currentHealth: number\n    maxHealth: number\n    buffs?: string[]\n    enemy?: EnemyInstance\n  }) {\n    super(data)\n    this.enemy = data.enemy || this.createDefaultEnemy(data)\n  }\n\n  private createDefaultEnemy(data: {\n    id: string\n    name: string\n    level: number\n    currentHealth: number\n    maxHealth: number\n  }): EnemyInstance {\n    const stats = {\n      health: data.maxHealth,\n      minAttack: data.level * 2,\n      maxAttack: data.level * 4,\n      defense: data.level,\n      speed: data.level * 2,\n    }\n\n    const buffs: string[] = []\n    const activeSkills = new Set<string>()\n    let enemyCurrentHealth = data.currentHealth\n    const enemyMaxHealth = data.maxHealth\n\n    return {\n      id: data.id,\n      name: data.name,\n      level: data.level,\n      stats,\n      drops: [],\n      skills: {},\n      get currentHealth() {\n        return enemyCurrentHealth\n      },\n      set currentHealth(value: number) {\n        enemyCurrentHealth = Math.max(0, Math.min(value, enemyMaxHealth))\n      },\n      buffs,\n      activeSkills,\n      lastActionTime: Date.now(),\n      get isDefeated() {\n        return enemyCurrentHealth <= 0\n      },\n      getAttribute: (attribute: string) => {\n        switch (attribute) {\n          case 'HP':\n            return enemyCurrentHealth\n          case 'MAX_HP':\n            return enemyMaxHealth\n          case 'ATK':\n            return stats.minAttack + (stats.maxAttack - stats.minAttack) / 2\n          case 'DEF':\n            return stats.defense\n          case 'SPD':\n            return stats.speed\n          default:\n            return 0\n        }\n      },\n      setAttribute: (attribute: string, value: number) => {\n        if (attribute === 'HP') {\n          enemyCurrentHealth = Math.max(0, Math.min(value, enemyMaxHealth))\n        }\n      },\n      addBuff: (buffInstanceId: string) => {\n        if (!buffs.includes(buffInstanceId)) {\n          buffs.push(buffInstanceId)\n        }\n      },\n      removeBuff: (buffInstanceId: string) => {\n        const index = buffs.indexOf(buffInstanceId)\n        if (index !== -1) {\n          buffs.splice(index, 1)\n        }\n      },\n      hasBuff: (buffId: string) => buffs.some((id) => id.includes(buffId)),\n    }\n  }\n}\n\nexport class GameBattleSystem implements IBattleSystem {\n  private static instance: GameBattleSystem\n  private battles = new Map<string, BattleData>()\n  private battleLogger = logger\n\n  private constructor() {}\n\n  public static getInstance(): GameBattleSystem {\n    if (!GameBattleSystem.instance) {\n      GameBattleSystem.instance = new GameBattleSystem()\n    }\n    return GameBattleSystem.instance\n  }\n\n  public createBattle(participantsInfo: ParticipantInfo[]): BattleState {\n    const battleId = `battle_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n\n    const participants = new Map<string, BattleParticipant>()\n    const turnOrder: string[] = []\n\n    // Create participants based on provided info\n    participantsInfo.forEach((info) => {\n      if (info.type === 'character') {\n        const participant = new SimpleBattleCharacter({\n          id: `character_${info.id}`,\n          name: info.name,\n          level: 5,\n          currentHealth: info.currentHealth,\n          maxHealth: info.maxHealth,\n          buffs: [],\n        })\n        participant.currentEnergy = info.currentEnergy\n        participant.maxEnergy = info.maxEnergy\n        participants.set(participant.id, participant)\n        turnOrder.push(participant.id)\n      } else if (info.type === 'enemy') {\n        const participant = new SimpleBattleEnemy({\n          id: `enemy_${info.id}`,\n          name: info.name,\n          level: 5,\n          currentHealth: info.currentHealth,\n          maxHealth: info.maxHealth,\n          buffs: [],\n        })\n        participant.currentEnergy = info.currentEnergy\n        participant.maxEnergy = info.maxEnergy\n        participants.set(participant.id, participant)\n        turnOrder.push(participant.id)\n      }\n    })\n\n    // Simple turn order based on speed (in real implementation, would use actual speed attribute)\n    turnOrder.sort(() => Math.random() - 0.5)\n\n    const aiInstances = new Map<string, BattleAI>()\n\n    // 为每个参与者创建AI实例\n    participants.forEach((participant) => {\n      const ai = BattleAIFactory.createAI(participant.type)\n      aiInstances.set(participant.id, ai)\n    })\n\n    const battleData: BattleData = {\n      battleId,\n      participants,\n      actions: [],\n      turnOrder,\n      currentTurn: 0,\n      isActive: true,\n      startTime: Date.now(),\n      winner: undefined,\n      aiInstances,\n    }\n\n    this.battles.set(battleId, battleData)\n    this.battleLogger.info(`Battle created: ${battleId}`, {\n      participantCount: participantsInfo.length,\n      characterCount: participantsInfo.filter((p) => p.type === 'character')\n        .length,\n      enemyCount: participantsInfo.filter((p) => p.type === 'enemy').length,\n    })\n\n    // Log initial battle state\n    this.addBattleAction(battleId, {\n      id: `init_${Date.now()}`,\n      type: 'attack',\n      sourceId: 'system',\n      targetId: 'system',\n      damage: 0,\n      heal: 0,\n      success: true,\n      timestamp: Date.now(),\n      effects: [\n        {\n          type: 'status',\n          description: `战斗开始！参战角色: ${participantsInfo.filter((p) => p.type === 'character').length} 人，参战敌人: ${participantsInfo.filter((p) => p.type === 'enemy').length} 人`,\n          duration: 0,\n        },\n      ],\n    })\n\n    return this.convertToBattleState(battleData)\n  }\n\n  public async processTurn(battleId: string): Promise<void> {\n    const battle = this.battles.get(battleId)\n    if (!battle || !battle.isActive) {\n      return\n    }\n\n    // 每回合开始时，所有存活的参与者获得25能量\n    battle.participants.forEach((participant) => {\n      if (participant.isAlive()) {\n        participant.gainEnergy(25)\n      }\n    })\n\n    if (battle.currentTurn >= battle.turnOrder.length) {\n      battle.currentTurn = 0\n    }\n\n    const currentParticipantId = battle.turnOrder[battle.currentTurn]\n    const participant = battle.participants.get(currentParticipantId)\n\n    if (!participant || !participant.isAlive()) {\n      battle.currentTurn++\n      return\n    }\n\n    try {\n      // 获取参与者的AI实例\n      const ai = battle.aiInstances.get(participant.id)\n      if (!ai) {\n        // 如果没有AI实例，使用默认AI\n        const defaultAi = BattleAIFactory.createAI(participant.type)\n        battle.aiInstances.set(participant.id, defaultAi)\n        await this.executeDefaultAction(battle, participant)\n      } else {\n        // 使用AI做出决策\n        const battleState = this.convertToBattleState(battle)\n        const action = ai.makeDecision(battleState, participant)\n        // 设置action的回合号\n        action.turn = battle.currentTurn + 1\n\n        // 确保目标有效\n        const target = battle.participants.get(action.targetId)\n        if (target && target.isAlive()) {\n          await this.executeAction(action)\n        } else {\n          // 目标无效，使用默认行动\n          await this.executeDefaultAction(battle, participant)\n        }\n      }\n    } catch (error) {\n      logger.error('AI决策出错:', error)\n      // 出错时使用默认行动\n      await this.executeDefaultAction(battle, participant)\n    }\n\n    battle.currentTurn++\n\n    // Check for battle end condition\n    const aliveCharacters = Array.from(battle.participants.values()).filter(\n      (p) => p.type === 'character' && p.isAlive(),\n    )\n    const aliveEnemies = Array.from(battle.participants.values()).filter(\n      (p) => p.type === 'enemy' && p.isAlive(),\n    )\n\n    if (aliveCharacters.length === 0) {\n      this.endBattle(battle.battleId, 'enemy')\n    } else if (aliveEnemies.length === 0) {\n      this.endBattle(battle.battleId, 'character')\n    }\n  }\n\n  // 执行默认行动\n  private async executeDefaultAction(\n    battle: BattleData,\n    participant: BattleParticipant,\n  ): Promise<void> {\n    const enemies = Array.from(battle.participants.values())\n      .filter((p) => p.type === 'enemy' && p.isAlive())\n      .map((p) => p.id)\n\n    const characters = Array.from(battle.participants.values())\n      .filter((p) => p.type === 'character' && p.isAlive())\n      .map((p) => p.id)\n\n    let targetId: string\n    let damage: number\n\n    if (participant.type === 'character' && enemies.length > 0) {\n      targetId = enemies[Math.floor(Math.random() * enemies.length)]\n      damage = Math.floor(Math.random() * 20) + 10\n    } else if (participant.type === 'enemy' && characters.length > 0) {\n      targetId = characters[Math.floor(Math.random() * characters.length)]\n      damage = Math.floor(Math.random() * 15) + 8\n    } else {\n      return\n    }\n\n\n    await this.executeAction({\n      id: `action_${Date.now()}`,\n      type: 'attack',\n      sourceId: participant.id,\n      targetId,\n      damage,\n      success: true,\n      timestamp: Date.now(),\n      turn: battle.currentTurn + 1,\n      effects: [\n        {\n          type: 'damage',\n          value: damage,\n          description: `${participant.name} 普通攻击 造成 ${damage} 伤害`,\n        },\n      ],\n    })\n  }\n\n  public async executeAction(action: BattleAction): Promise<BattleAction> {\n    const battle = this.findBattleByParticipant(action.sourceId)\n    if (!battle) {\n      throw new Error(\n        `No active battle found for participant ${action.sourceId}`,\n      )\n    }\n\n    const source = battle.participants.get(action.sourceId)\n    const target = battle.participants.get(action.targetId)\n\n    if (!source || !target) {\n      throw new Error(`Invalid source or target in action`)\n    }\n\n    // 处理技能执行\n    if (action.type === 'skill' && action.skillId) {\n      // 模拟技能能量消耗\n      const energyCost = this.getSkillEnergyCost(action.skillId)\n      if (energyCost > 0) {\n        const success = source.spendEnergy(energyCost)\n        if (!success) {\n          // 能量不足，改为普通攻击\n          action.type = 'attack'\n          action.damage = Math.floor(Math.random() * 20) + 10\n          action.effects = [\n            {\n              type: 'damage',\n              value: action.damage,\n              description: `${source.name} 普通攻击 (能量不足)`,\n            },\n          ]\n        } else {\n          // 能量消耗成功\n          action.effects.push({\n            type: 'status',\n            description: `消耗 ${energyCost} 能量`,\n          })\n        }\n      }\n    }\n\n    // Apply damage or heal\n    if (action.damage && action.damage > 0) {\n      const actualDamage = target.takeDamage(action.damage)\n      action.damage = actualDamage\n\n      this.battleLogger.info(`Damage dealt: ${source.name} → ${target.name}`, {\n        damage: actualDamage,\n        targetHealth: target.currentHealth,\n      })\n    }\n\n    if (action.heal && action.heal > 0) {\n      const actualHeal = target.heal(action.heal)\n      action.heal = actualHeal\n\n      this.battleLogger.info(`Heal applied: ${source.name} → ${target.name}`, {\n        heal: actualHeal,\n        targetHealth: target.currentHealth,\n      })\n    }\n\n    // Apply buff if specified\n    if (action.buffId) {\n      // In a real implementation, this would use the BuffSystem\n      const buffInstanceId = `${target.id}_${action.buffId}_${Date.now()}`\n      target.addBuff(buffInstanceId)\n\n      action.effects.push({\n        type: 'buff',\n        buffId: action.buffId,\n        description: `${action.buffId} applied to ${target.name}`,\n      })\n    }\n\n    // 行动后处理\n    source.afterAction()\n\n    // Add action to battle log\n    this.addBattleAction(battle.battleId, action)\n\n    return action\n  }\n\n  // 获取技能能量消耗\n  private getSkillEnergyCost(skillId: string): number {\n    // 实现50能量释放小技能，100能量释放大招的机制\n    if (skillId.includes('ultimate') || skillId.includes('大招')) {\n      return 100 // 大招消耗100能量\n    } else if (skillId.includes('skill') || skillId.includes('技能')) {\n      return 50 // 小技能消耗50能量\n    }\n    return 0\n  }\n\n  public getBattleState(battleId: string): BattleState | undefined {\n    const battle = this.battles.get(battleId)\n    if (!battle) return undefined\n\n    return this.convertToBattleState(battle)\n  }\n\n  public endBattle(battleId: string, winner: BattleEntityType): void {\n    const battle = this.battles.get(battleId)\n    if (!battle) return\n\n    battle.isActive = false\n    battle.winner = winner\n    battle.endTime = Date.now()\n\n    this.addBattleAction(battleId, {\n      id: `end_${Date.now()}`,\n      type: 'skill',\n      sourceId: 'system',\n      targetId: 'system',\n      success: true,\n      timestamp: Date.now(),\n      turn: battle.currentTurn + 1,\n      effects: [\n        {\n          type: 'status',\n          description: `战斗结束！胜利者: ${winner === 'character' ? '角色方' : '敌方'}`,\n          duration: 0,\n        },\n      ],\n    })\n\n    this.battleLogger.info(`Battle ended: ${battleId}`, { winner })\n  }\n\n  private addBattleAction(battleId: string, action: BattleAction): void {\n    const battle = this.battles.get(battleId)\n    if (!battle) return\n\n    battle.actions.push(action)\n\n    // Keep only last 100 actions to prevent memory issues\n    if (battle.actions.length > 100) {\n      battle.actions = battle.actions.slice(-100)\n    }\n  }\n\n  private findBattleByParticipant(\n    participantId: string,\n  ): BattleData | undefined {\n    for (const battle of this.battles.values()) {\n      if (battle.participants.has(participantId) && battle.isActive) {\n        return battle\n      }\n    }\n    return undefined\n  }\n\n  private convertToBattleState(battleData: BattleData): BattleState {\n    return {\n      battleId: battleData.battleId,\n      participants: new Map(battleData.participants),\n      actions: [...battleData.actions],\n      turnOrder: [...battleData.turnOrder],\n      currentTurn: battleData.currentTurn,\n      isActive: battleData.isActive,\n      startTime: battleData.startTime,\n      endTime: battleData.endTime,\n      winner: battleData.winner,\n    }\n  }\n\n  // Additional helper methods for UI integration\n  public getAllBattles(): BattleState[] {\n    return Array.from(this.battles.values()).map((b) =>\n      this.convertToBattleState(b),\n    )\n  }\n\n  public getActiveBattles(): BattleState[] {\n    return Array.from(this.battles.values())\n      .filter((b) => b.isActive)\n      .map((b) => this.convertToBattleState(b))\n  }\n\n  public clearCompletedBattles(): void {\n    for (const [battleId, battle] of this.battles.entries()) {\n      if (!battle.isActive) {\n        this.battles.delete(battleId)\n      }\n    }\n  }\n}\n","import { logger } from './logger'\r\n\r\ninterface PerformanceMetric {\r\n  name: string\r\n  calls: number\r\n  totalTime: number\r\n  avgTime: number\r\n  maxTime: number\r\n  minTime: number\r\n}\r\n\r\nclass PerformanceMonitor {\r\n  private metrics = new Map<string, PerformanceMetric>()\r\n  private enabled = false\r\n\r\n  public enable(): void {\r\n    this.enabled = true\r\n    logger.info('Performance monitoring enabled')\r\n  }\r\n\r\n  public disable(): void {\r\n    this.enabled = false\r\n    logger.info('Performance monitoring disabled')\r\n  }\r\n\r\n  public measure<T>(name: string, fn: () => T): T {\r\n    if (!this.enabled) {\r\n      return fn()\r\n    }\r\n\r\n    const start = performance.now()\r\n    const result = fn()\r\n    const end = performance.now()\r\n    const duration = end - start\r\n\r\n    this.recordMetric(name, duration)\r\n\r\n    return result\r\n  }\r\n\r\n  private recordMetric(name: string, duration: number): void {\r\n    if (!this.metrics.has(name)) {\r\n      this.metrics.set(name, {\r\n        name,\r\n        calls: 0,\r\n        totalTime: 0,\r\n        avgTime: 0,\r\n        maxTime: 0,\r\n        minTime: Infinity\r\n      })\r\n    }\r\n\r\n    const metric = this.metrics.get(name)!\r\n    metric.calls++\r\n    metric.totalTime += duration\r\n    metric.avgTime = metric.totalTime / metric.calls\r\n    metric.maxTime = Math.max(metric.maxTime, duration)\r\n    metric.minTime = Math.min(metric.minTime, duration)\r\n  }\r\n\r\n  public getMetrics(): PerformanceMetric[] {\r\n    return Array.from(this.metrics.values())\r\n  }\r\n\r\n  public getMetric(name: string): PerformanceMetric | undefined {\r\n    return this.metrics.get(name)\r\n  }\r\n\r\n  public reset(): void {\r\n    this.metrics.clear()\r\n    logger.info('Performance metrics reset')\r\n  }\r\n\r\n  public printReport(): void {\r\n    if (!this.enabled || this.metrics.size === 0) {\r\n      logger.info('No performance metrics to report')\r\n      return\r\n    }\r\n\r\n    logger.info('=== Performance Report ===')\r\n    this.getMetrics().forEach((metric) => {\r\n      logger.info(`${metric.name}:`, {\r\n        calls: metric.calls,\r\n        avgTime: `${metric.avgTime.toFixed(2)}ms`,\r\n        maxTime: `${metric.maxTime.toFixed(2)}ms`,\r\n        minTime: `${metric.minTime.toFixed(2)}ms`,\r\n        totalTime: `${metric.totalTime.toFixed(2)}ms`\r\n      })\r\n    })\r\n    logger.info('========================')\r\n  }\r\n}\r\n\r\nexport const perfMonitor = new PerformanceMonitor()\r\nexport const measure = (name: string, fn: () => any) => {\r\n  return perfMonitor.measure(name, fn)\r\n}\r\n","import { logger } from './logger'\r\n\r\ninterface ObjectPoolOptions<T> {\r\n  maxSize: number\r\n  create: () => T\r\n  reset: (obj: T) => void\r\n  validate?: (obj: T) => boolean\r\n}\r\n\r\nexport class ObjectPool<T> {\r\n  private pool: T[] = []\r\n  private options: ObjectPoolOptions<T>\r\n  private borrowedCount = 0\r\n\r\n  constructor(options: ObjectPoolOptions<T>) {\r\n    this.options = options\r\n  }\r\n\r\n  public borrow(): T {\r\n    if (this.pool.length > 0) {\r\n      const obj = this.pool.pop()!\r\n      if (this.options.validate && !this.options.validate(obj)) {\r\n        logger.warn('Object pool validation failed, creating new instance')\r\n        return this.options.create()\r\n      }\r\n      this.borrowedCount++\r\n      return obj\r\n    }\r\n\r\n    if (this.borrowedCount >= this.options.maxSize) {\r\n      logger.warn('Object pool max size reached, creating new instance')\r\n    }\r\n\r\n    this.borrowedCount++\r\n    return this.options.create()\r\n  }\r\n\r\n  public return(obj: T): void {\r\n    if (this.pool.length >= this.options.maxSize) {\r\n      logger.debug('Object pool full, discarding instance')\r\n      return\r\n    }\r\n\r\n    try {\r\n      this.options.reset(obj)\r\n      this.pool.push(obj)\r\n      this.borrowedCount = Math.max(0, this.borrowedCount - 1)\r\n    } catch (error) {\r\n      logger.error('Failed to reset object in pool:', error)\r\n    }\r\n  }\r\n\r\n  public getPoolSize(): number {\r\n    return this.pool.length\r\n  }\r\n\r\n  public getBorrowedCount(): number {\r\n    return this.borrowedCount\r\n  }\r\n\r\n  public clear(): void {\r\n    this.pool = []\r\n    this.borrowedCount = 0\r\n    logger.info('Object pool cleared')\r\n  }\r\n\r\n  public prewarm(count: number): void {\r\n    for (let i = 0; i < count && this.pool.length < this.options.maxSize; i++) {\r\n      this.pool.push(this.options.create())\r\n    }\r\n    logger.info(`Object pool prewarmed with ${count} instances`)\r\n  }\r\n}\r\n\r\n// 预定义的对象池实例\r\nexport const createBuffContextPool = () => {\r\n  return new ObjectPool({\r\n    maxSize: 100,\r\n    create: () => {\r\n      // 注意：这里只是占位，实际的 BuffContext 创建需要具体参数\r\n      // 实际使用时，需要在 borrow 后进行初始化\r\n      return {} as any\r\n    },\r\n    reset: (context) => {\r\n      // 重置 BuffContext 的状态\r\n      if (context.variables) {\r\n        context.variables.clear()\r\n      }\r\n    }\r\n  })\r\n}\r\n","import { logger } from './logger'\r\n\r\ninterface ValidationError {\r\n  field: string\r\n  message: string\r\n}\r\n\r\ninterface Schema {\r\n  type: string\r\n  properties?: Record<string, Schema>\r\n  required?: string[]\r\n  minLength?: number\r\n  maxLength?: number\r\n  minimum?: number\r\n  maximum?: number\r\n  enum?: any[]\r\n}\r\n\r\nexport class SchemaValidator {\r\n  public validate(data: any, schema: Schema): {\r\n    valid: boolean\r\n    errors: ValidationError[]\r\n  } {\r\n    const errors: ValidationError[] = []\r\n    this.validateValue('', data, schema, errors)\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors\r\n    }\r\n  }\r\n\r\n  private validateValue(\r\n    path: string,\r\n    value: any,\r\n    schema: Schema,\r\n    errors: ValidationError[]\r\n  ): void {\r\n    // 验证类型\r\n    if (schema.type === 'string' && typeof value !== 'string') {\r\n      errors.push({\r\n        field: path || 'root',\r\n        message: 'Expected string'\r\n      })\r\n      return\r\n    }\r\n\r\n    if (schema.type === 'number' && typeof value !== 'number') {\r\n      errors.push({\r\n        field: path || 'root',\r\n        message: 'Expected number'\r\n      })\r\n      return\r\n    }\r\n\r\n    if (schema.type === 'boolean' && typeof value !== 'boolean') {\r\n      errors.push({\r\n        field: path || 'root',\r\n        message: 'Expected boolean'\r\n      })\r\n      return\r\n    }\r\n\r\n    if (schema.type === 'array' && !Array.isArray(value)) {\r\n      errors.push({\r\n        field: path || 'root',\r\n        message: 'Expected array'\r\n      })\r\n      return\r\n    }\r\n\r\n    if (schema.type === 'object' && typeof value !== 'object') {\r\n      errors.push({\r\n        field: path || 'root',\r\n        message: 'Expected object'\r\n      })\r\n      return\r\n    }\r\n\r\n    // 验证字符串长度\r\n    if (schema.type === 'string') {\r\n      if (schema.minLength !== undefined && value.length < schema.minLength) {\r\n        errors.push({\r\n          field: path || 'root',\r\n          message: `String length must be at least ${schema.minLength}`\r\n        })\r\n      }\r\n      if (schema.maxLength !== undefined && value.length > schema.maxLength) {\r\n        errors.push({\r\n          field: path || 'root',\r\n          message: `String length must be at most ${schema.maxLength}`\r\n        })\r\n      }\r\n    }\r\n\r\n    // 验证数字范围\r\n    if (schema.type === 'number') {\r\n      if (schema.minimum !== undefined && value < schema.minimum) {\r\n        errors.push({\r\n          field: path || 'root',\r\n          message: `Number must be at least ${schema.minimum}`\r\n        })\r\n      }\r\n      if (schema.maximum !== undefined && value > schema.maximum) {\r\n        errors.push({\r\n          field: path || 'root',\r\n          message: `Number must be at most ${schema.maximum}`\r\n        })\r\n      }\r\n    }\r\n\r\n    // 验证枚举值\r\n    if (schema.enum !== undefined && !schema.enum.includes(value)) {\r\n      errors.push({\r\n        field: path || 'root',\r\n        message: `Value must be one of: ${schema.enum.join(', ')}`\r\n      })\r\n    }\r\n\r\n    // 验证对象属性\r\n    if (schema.type === 'object' && typeof value === 'object' && value !== null) {\r\n      if (schema.required) {\r\n        for (const requiredField of schema.required) {\r\n          if (!(requiredField in value)) {\r\n            errors.push({\r\n              field: path ? `${path}.${requiredField}` : requiredField,\r\n              message: 'Required field'\r\n            })\r\n          }\r\n        }\r\n      }\r\n\r\n      if (schema.properties) {\r\n        for (const [key, propertySchema] of Object.entries(schema.properties)) {\r\n          if (key in value) {\r\n            this.validateValue(\r\n              path ? `${path}.${key}` : key,\r\n              value[key],\r\n              propertySchema,\r\n              errors\r\n            )\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public validateBuffConfig(config: any): boolean {\r\n    const schema: Schema = {\r\n      type: 'object',\r\n      required: ['id', 'name', 'description', 'duration', 'maxStacks', 'cooldown'],\r\n      properties: {\r\n        id: {\r\n          type: 'string',\r\n          minLength: 1\r\n        },\r\n        name: {\r\n          type: 'string',\r\n          minLength: 1\r\n        },\r\n        description: {\r\n          type: 'string'\r\n        },\r\n        duration: {\r\n          type: 'number',\r\n          minimum: -1\r\n        },\r\n        maxStacks: {\r\n          type: 'number',\r\n          minimum: 1\r\n        },\r\n        cooldown: {\r\n          type: 'number',\r\n          minimum: 0\r\n        },\r\n        isPermanent: {\r\n          type: 'boolean'\r\n        },\r\n        isDebuff: {\r\n          type: 'boolean'\r\n        },\r\n        parameters: {\r\n          type: 'object'\r\n        }\r\n      }\r\n    }\r\n\r\n    const result = this.validate(config, schema)\r\n    if (!result.valid) {\r\n      logger.error('Invalid buff config:', result.errors)\r\n      return false\r\n    }\r\n    return true\r\n  }\r\n}\r\n\r\nexport const schemaValidator = new SchemaValidator()\r\n","import type { IBuffScript } from '@/types/buff'\nimport type { BuffContext } from '@/core/BuffContext'\nimport { BuffErrorBoundary } from '@/core/BuffErrorBoundary'\nimport { logger } from '@/utils/logger'\n\nexport abstract class BaseBuffScript<TParams = any> implements IBuffScript<TParams> {\n  params?: TParams\n  \n  public onApply(context: BuffContext): void {\n    BuffErrorBoundary.wrap(() => {\n      this._onApply(context)\n    })\n  }\n\n  public onRemove(context: BuffContext): void {\n    BuffErrorBoundary.wrap(() => {\n      this._onRemove(context)\n      context.removeModifiers()\n    })\n  }\n\n  public onUpdate(context: BuffContext, deltaTime: number): void {\n    BuffErrorBoundary.wrap(() => {\n      this._onUpdate(context, deltaTime)\n    })\n  }\n\n  public onRefresh(context: BuffContext): void {\n    BuffErrorBoundary.wrap(() => {\n      this._onRefresh(context)\n    })\n  }\n\n  protected abstract _onApply(context: BuffContext): void\n  protected abstract _onRemove(context: BuffContext): void\n  protected abstract _onUpdate(context: BuffContext, deltaTime: number): void\n  protected abstract _onRefresh(context: BuffContext): void\n\n  protected addModifier(\n    context: BuffContext,\n    attribute: string,\n    value: number,\n    type: 'ADDITIVE' | 'MULTIPLICATIVE' | 'PERCENTAGE'\n  ): void {\n    context.addModifier(attribute, value, type)\n  }\n\n  protected getConfigValue<T>(\n    context: BuffContext,\n    key: string,\n    defaultValue: T\n  ): T {\n    return context.config.parameters?.[key] ?? defaultValue\n  }\n\n  protected log(context: BuffContext, message: string): void {\n    logger.debug(`[${context.config.id}] ${message}`)\n  }\n\n  protected triggerEvent(\n    context: BuffContext,\n    eventName: string,\n    data?: any\n  ): void {\n    context.triggerEvent(eventName, data)\n  }\n}\n","import type { Character } from '@/types/character'\r\nimport type { BuffContext } from '@/core/BuffContext'\r\n\r\nexport class BuffScriptUtils {\r\n  public static calculateDamage(\r\n    attacker: Character,\r\n    defender: Character,\r\n    baseDamage: number,\r\n    isCritical: boolean = false\r\n  ): number {\r\n    const attack = attacker.getAttribute('ATK')\r\n    const defense = defender.getAttribute('DEF')\r\n    \r\n    // 基础伤害计算\r\n    let damage = baseDamage * (attack / (attack + defense * 0.8))\r\n    \r\n    // 暴击伤害计算\r\n    if (isCritical) {\r\n      const critDmg = attacker.getAttribute('CRIT_DMG')\r\n      damage *= (1 + critDmg)\r\n    }\r\n    \r\n    // 确保伤害不低于最小值\r\n    return Math.max(1, Math.floor(damage))\r\n  }\r\n\r\n  public static calculateHealing(\r\n    character: Character,\r\n    baseHealing: number\r\n  ): number {\r\n    const level = character.level\r\n    const maxHP = character.getAttribute('HP')\r\n    \r\n    // 治疗量计算，基于角色等级和最大生命值\r\n    let healing = baseHealing * (1 + level * 0.01)\r\n    \r\n    // 确保治疗量不超过最大生命值的一定比例\r\n    const maxHealing = maxHP * 0.3\r\n    return Math.min(maxHealing, Math.floor(healing))\r\n  }\r\n\r\n  public static checkCondition(\r\n    context: BuffContext,\r\n    condition: {\r\n      type: string\r\n      attribute?: string\r\n      operator?: string\r\n      value?: number\r\n    }\r\n  ): boolean {\r\n    switch (condition.type) {\r\n      case 'HP_BELOW':\r\n        return context.getAttributeValue('HP') < condition.value!\r\n      case 'MP_BELOW':\r\n        return context.getAttributeValue('MP') < condition.value!\r\n      case 'LEVEL_ABOVE':\r\n        // 假设角色等级可以通过 context 获取\r\n        return (context.getCharacter()?.level || 0) > condition.value!\r\n      case 'HAS_BUFF':\r\n        // 假设可以检查角色是否有特定 Buff\r\n        return context.getCharacter()?.hasBuff(condition.attribute!) ?? false\r\n      default:\r\n        return true\r\n    }\r\n  }\r\n\r\n  public static getRandomValue(min: number, max: number): number {\r\n    return Math.random() * (max - min) + min\r\n  }\r\n\r\n  public static getRandomInt(min: number, max: number): number {\r\n    return Math.floor(Math.random() * (max - min + 1)) + min\r\n  }\r\n\r\n  public static calculateDuration(\r\n    baseDuration: number,\r\n    scaleFactor: number = 1,\r\n    level: number = 1\r\n  ): number {\r\n    return baseDuration * scaleFactor * (1 + level * 0.05)\r\n  }\r\n\r\n  public static calculateEffectValue(\r\n    baseValue: number,\r\n    scaleFactor: number = 1,\r\n    level: number = 1\r\n  ): number {\r\n    return baseValue * scaleFactor * (1 + level * 0.08)\r\n  }\r\n\r\n  public static formatDuration(ms: number): string {\r\n    if (ms < 1000) {\r\n      return `${ms}ms`\r\n    } else if (ms < 60000) {\r\n      return `${(ms / 1000).toFixed(1)}s`\r\n    } else {\r\n      const minutes = Math.floor(ms / 60000)\r\n      const seconds = Math.floor((ms % 60000) / 1000)\r\n      return `${minutes}m ${seconds}s`\r\n    }\r\n  }\r\n\r\n  public static isExpired(context: BuffContext): boolean {\r\n    const remaining = context.getRemainingTime()\r\n    return remaining >= 0 && remaining <= 0\r\n  }\r\n\r\n  public static canStack(context: BuffContext, maxStacks: number): boolean {\r\n    const character = context.getCharacter()\r\n    if (!character) return false\r\n    \r\n    const buffId = context.config.id\r\n    const currentStacks = character.buffs.filter(\r\n      (buffInstanceId) => buffInstanceId.includes(buffId)\r\n    ).length\r\n    \r\n    return currentStacks < maxStacks\r\n  }\r\n}\r\n","import { BaseBuffScript } from '../base/BaseBuffScript'\r\nimport type { BuffContext } from '@/core/BuffContext'\r\n\r\nexport class MountainGodBuff extends BaseBuffScript {\r\n  public static readonly BUFF_ID = 'mountain_god'\r\n\r\n  protected _onApply(context: BuffContext): void {\r\n    this.log(context, '山神降临！获得强大的力量')\r\n    \r\n    // 添加攻击力和防御力提升\r\n    const attackBonus = this.getConfigValue(context, 'attackBonus', 50)\r\n    const defenseBonus = this.getConfigValue(context, 'defenseBonus', 30)\r\n    \r\n    this.addModifier(context, 'ATK', attackBonus, 'ADDITIVE')\r\n    this.addModifier(context, 'DEF', defenseBonus, 'ADDITIVE')\r\n    \r\n    // 添加暴击率提升\r\n    this.addModifier(context, 'CRIT_RATE', 0.1, 'ADDITIVE')\r\n    \r\n    context.setVariable('initialAttackBonus', attackBonus)\r\n  }\r\n\r\n  protected _onRemove(context: BuffContext): void {\r\n    this.log(context, '山神之力消散')\r\n  }\r\n\r\n  protected _onUpdate(context: BuffContext, deltaTime: number): void {\r\n    // 每秒钟恢复少量生命值\r\n    const elapsed = context.getElapsedTime()\r\n    if (Math.floor(elapsed / 1000) > Math.floor((elapsed - deltaTime) / 1000)) {\r\n      const regeneration = this.getConfigValue(context, 'regeneration', 5)\r\n      this.log(context, `山神的祝福：恢复 ${regeneration} 生命值`)\r\n      // 这里应该调用角色的治疗方法\r\n    }\r\n  }\r\n\r\n  protected _onRefresh(context: BuffContext): void {\r\n    this.log(context, '山神之力得到强化！')\r\n    \r\n    // 刷新时增加额外的攻击力\r\n    const refreshBonus = this.getConfigValue(context, 'refreshBonus', 10)\r\n    \r\n    this.addModifier(context, 'ATK', refreshBonus, 'ADDITIVE')\r\n    \r\n    this.log(context, `获得额外 ${refreshBonus} 攻击力`)    \r\n  }\r\n}\r\n\r\n// 导出 BUFF_ID 常量\r\nexport const BUFF_ID = MountainGodBuff.BUFF_ID\r\n","import { BaseBuffScript } from '../base/BaseBuffScript'\r\nimport type { BuffContext } from '@/core/BuffContext'\r\n\r\nexport class PoisonDebuff extends BaseBuffScript {\r\n  public static readonly BUFF_ID = 'poison'\r\n\r\n  protected _onApply(context: BuffContext): void {\r\n    this.log(context, '中毒了！毒素开始侵蚀身体')\r\n    \r\n    // 降低移动速度\r\n    this.addModifier(context, 'SPD', -0.2, 'MULTIPLICATIVE')\r\n    \r\n    // 记录初始伤害值\r\n    const baseDamage = this.getConfigValue(context, 'baseDamage', 10)\r\n    context.setVariable('baseDamage', baseDamage)\r\n    context.setVariable('lastDamageTime', 0)\r\n  }\r\n\r\n  protected _onRemove(context: BuffContext): void {\r\n    this.log(context, '毒素效果消失')\r\n  }\r\n\r\n  protected _onUpdate(context: BuffContext, _deltaTime: number): void {\r\n    const elapsed = context.getElapsedTime()\r\n    const lastDamageTime = context.getVariable<number>('lastDamageTime') || 0\r\n    const damageInterval = this.getConfigValue(context, 'damageInterval', 2000)\r\n    \r\n    // 每隔一段时间造成伤害\r\n    if (elapsed - lastDamageTime >= damageInterval) {\r\n      const baseDamage = context.getVariable<number>('baseDamage') || 10\r\n      const damageMultiplier = this.getConfigValue(context, 'damageMultiplier', 1.2)\r\n      \r\n      // 计算当前伤害（随时间递增）\r\n      const stacks = Math.floor(elapsed / damageInterval)\r\n      const currentDamage = Math.floor(baseDamage * Math.pow(damageMultiplier, stacks))\r\n      \r\n      this.log(context, `毒素伤害：${currentDamage}`)\r\n      // 这里应该调用角色的伤害方法\r\n      \r\n      context.setVariable('lastDamageTime', elapsed)\r\n    }\r\n  }\r\n\r\n  protected _onRefresh(context: BuffContext): void {\r\n    this.log(context, '毒素效果增强！')\r\n    \r\n    // 刷新时增加伤害\r\n    const baseDamage = context.getVariable<number>('baseDamage') || 10\r\n    const refreshBonus = this.getConfigValue(context, 'refreshBonus', 5)\r\n    \r\n    context.setVariable('baseDamage', baseDamage + refreshBonus)\r\n    \r\n    this.log(context, `毒素伤害提升至 ${baseDamage + refreshBonus}`)\r\n  }\r\n}\r\n\r\n// 导出 BUFF_ID 常量\r\nexport const BUFF_ID = PoisonDebuff.BUFF_ID\r\n","import { BaseBuffScript } from '../base/BaseBuffScript'\r\nimport type { BuffContext } from '@/core/BuffContext'\r\n\r\nexport class BerserkBuff extends BaseBuffScript {\r\n  public static readonly BUFF_ID = 'berserk'\r\n\r\n  protected _onApply(context: BuffContext): void {\r\n    this.log(context, '陷入狂暴状态！攻击力大幅提升，但防御力降低')\r\n    \r\n    // 大幅提升攻击力\r\n    const attackBonus = this.getConfigValue(context, 'attackBonus', 100)\r\n    this.addModifier(context, 'ATK', attackBonus, 'ADDITIVE')\r\n    \r\n    // 大幅提升暴击率和暴击伤害\r\n    this.addModifier(context, 'CRIT_RATE', 0.2, 'ADDITIVE')\r\n    this.addModifier(context, 'CRIT_DMG', 0.5, 'ADDITIVE')\r\n    \r\n    // 降低防御力\r\n    this.addModifier(context, 'DEF', -0.3, 'MULTIPLICATIVE')\r\n    \r\n    context.setVariable('attackBonus', attackBonus)\r\n  }\r\n\r\n  protected _onRemove(context: BuffContext): void {\r\n    this.log(context, '狂暴状态结束，恢复平静')\r\n  }\r\n\r\n  protected _onUpdate(context: BuffContext, deltaTime: number): void {\r\n    // 每秒钟损失少量生命值（狂暴的代价）\r\n    const elapsed = context.getElapsedTime()\r\n    if (Math.floor(elapsed / 1000) > Math.floor((elapsed - deltaTime) / 1000)) {\r\n      const selfDamage = this.getConfigValue(context, 'selfDamage', 5)\r\n      this.log(context, `狂暴的代价：损失 ${selfDamage} 生命值`)\r\n      // 这里应该调用角色的伤害方法\r\n    }\r\n  }\r\n\r\n  protected _onRefresh(context: BuffContext): void {\r\n    this.log(context, '狂暴之力进一步增强！')\r\n    \r\n    // 刷新时增加额外的攻击力和暴击率\r\n    const attackBonus = this.getConfigValue(context, 'refreshAttackBonus', 20)\r\n    const critRateBonus = this.getConfigValue(context, 'refreshCritRateBonus', 0.05)\r\n    \r\n    this.addModifier(context, 'ATK', attackBonus, 'ADDITIVE')\r\n    this.addModifier(context, 'CRIT_RATE', critRateBonus, 'ADDITIVE')\r\n    \r\n    this.log(context, `获得额外 ${attackBonus} 攻击力和 ${(critRateBonus * 100).toFixed(0)}% 暴击率`)\r\n  }\r\n}\r\n\r\n// 导出 BUFF_ID 常量\r\nexport const BUFF_ID = BerserkBuff.BUFF_ID\r\n","import { BaseBuffScript } from '../base/BaseBuffScript'\r\nimport type { BuffContext } from '@/core/BuffContext'\r\n\r\nexport class HealOverTime extends BaseBuffScript {\r\n  public static readonly BUFF_ID = 'heal_over_time'\r\n\r\n  protected _onApply(context: BuffContext): void {\r\n    this.log(context, '获得持续治疗效果')\r\n    \r\n    // 记录治疗相关参数\r\n    const baseHealing = this.getConfigValue(context, 'baseHealing', 20)\r\n    const healInterval = this.getConfigValue(context, 'healInterval', 1000)\r\n    \r\n    context.setVariable('baseHealing', baseHealing)\r\n    context.setVariable('healInterval', healInterval)\r\n    context.setVariable('lastHealTime', 0)\r\n  }\r\n\r\n  protected _onRemove(context: BuffContext): void {\r\n    this.log(context, '持续治疗效果结束')\r\n  }\r\n\r\n  protected _onUpdate(context: BuffContext, _deltaTime: number): void {\r\n    const elapsed = context.getElapsedTime()\r\n    const lastHealTime = context.getVariable<number>('lastHealTime') || 0\r\n    const healInterval = context.getVariable<number>('healInterval') || 1000\r\n    \r\n    // 每隔一段时间恢复生命值\r\n    if (elapsed - lastHealTime >= healInterval) {\r\n      const baseHealing = context.getVariable<number>('baseHealing') || 20\r\n      const healingBonus = this.getConfigValue(context, 'healingBonus', 0)\r\n      \r\n      const currentHealing = baseHealing + healingBonus\r\n      \r\n      this.log(context, `持续治疗：恢复 ${currentHealing} 生命值`)\r\n      // 这里应该调用角色的治疗方法\r\n      \r\n      context.setVariable('lastHealTime', elapsed)\r\n    }\r\n  }\r\n\r\n  protected _onRefresh(context: BuffContext): void {\r\n    this.log(context, '持续治疗效果增强！')\r\n    \r\n    // 刷新时增加治疗量\r\n    const baseHealing = context.getVariable<number>('baseHealing') || 20\r\n    const refreshBonus = this.getConfigValue(context, 'refreshBonus', 5)\r\n    \r\n    context.setVariable('baseHealing', baseHealing + refreshBonus)\r\n    \r\n    this.log(context, `治疗量提升至 ${baseHealing + refreshBonus}`)\r\n  }\r\n}\r\n\r\n// 导出 BUFF_ID 常量\r\nexport const BUFF_ID = HealOverTime.BUFF_ID\r\n","import { BaseBuffScript } from '../base/BaseBuffScript'\r\nimport type { BuffContext } from '@/core/BuffContext'\r\n\r\nexport class ShieldBuff extends BaseBuffScript {\r\n  public static readonly BUFF_ID = 'shield'\r\n\r\n  protected _onApply(context: BuffContext): void {\r\n    this.log(context, '获得护盾保护')\r\n    \r\n    // 计算护盾值\r\n    const baseShield = this.getConfigValue(context, 'baseShield', 100)\r\n    const shieldScale = this.getConfigValue(context, 'shieldScale', 1)\r\n    \r\n    const character = context.getCharacter()\r\n    const maxHP = character ? character.getAttribute('HP') : 1000\r\n    const shieldValue = Math.floor(baseShield * shieldScale + maxHP * 0.1)\r\n    \r\n    // 记录护盾相关参数\r\n    context.setVariable('shieldValue', shieldValue)\r\n    context.setVariable('maxShieldValue', shieldValue)\r\n    context.setVariable('shieldRegen', this.getConfigValue(context, 'shieldRegen', 0))\r\n  }\r\n\r\n  protected _onRemove(context: BuffContext): void {\r\n    const remainingShield = context.getVariable<number>('shieldValue') || 0\r\n    this.log(context, `护盾效果消失，剩余护盾值：${remainingShield}`)\r\n  }\r\n\r\n  protected _onUpdate(context: BuffContext, deltaTime: number): void {\r\n    // 每秒钟恢复少量护盾值\r\n    const shieldRegen = context.getVariable<number>('shieldRegen') || 0\r\n    if (shieldRegen > 0) {\r\n      const elapsed = context.getElapsedTime()\r\n      if (Math.floor(elapsed / 1000) > Math.floor((elapsed - deltaTime) / 1000)) {\r\n        const currentShield = context.getVariable<number>('shieldValue') || 0\r\n        const maxShield = context.getVariable<number>('maxShieldValue') || 100\r\n        \r\n        const newShield = Math.min(currentShield + shieldRegen, maxShield)\r\n        context.setVariable('shieldValue', newShield)\r\n        \r\n        this.log(context, `护盾恢复：${shieldRegen}，当前护盾值：${newShield}`)\r\n      }\r\n    }\r\n  }\r\n\r\n  protected _onRefresh(context: BuffContext): void {\r\n    this.log(context, '护盾效果增强！')\r\n    \r\n    // 刷新时增加护盾值\r\n    const currentShield = context.getVariable<number>('shieldValue') || 0\r\n    const maxShield = context.getVariable<number>('maxShieldValue') || 100\r\n    const refreshBonus = this.getConfigValue(context, 'refreshBonus', 20)\r\n    \r\n    const newMaxShield = maxShield + refreshBonus\r\n    const newShield = currentShield + refreshBonus\r\n    \r\n    context.setVariable('shieldValue', newShield)\r\n    context.setVariable('maxShieldValue', newMaxShield)\r\n    \r\n    this.log(context, `护盾值提升至 ${newShield}/${newMaxShield}`)\r\n  }\r\n}\r\n\r\n// 导出 BUFF_ID 常量\r\nexport const BUFF_ID = ShieldBuff.BUFF_ID\r\n","// 导出所有 Buff 脚本\r\nexport * from './base/BaseBuffScript'\r\nexport * from './base/BuffScriptUtils'\r\n\r\n// 单独导出类，避免 BUFF_ID 冲突\r\nexport { MountainGodBuff } from './combat/MountainGodBuff'\r\nexport { PoisonDebuff } from './combat/PoisonDebuff'\r\nexport { BerserkBuff } from './combat/BerserkBuff'\r\nexport { HealOverTime } from './support/HealOverTime'\r\nexport { ShieldBuff } from './support/ShieldBuff'\r\n\r\n// 导出脚本映射，方便注册\r\nexport const buffScripts = {\r\n  mountain_god: () => import('./combat/MountainGodBuff'),\r\n  poison: () => import('./combat/PoisonDebuff'),\r\n  berserk: () => import('./combat/BerserkBuff'),\r\n  heal_over_time: () => import('./support/HealOverTime'),\r\n  shield: () => import('./support/ShieldBuff')\r\n}\r\n\r\nexport type BuffScriptType = keyof typeof buffScripts\r\n","// 核心引擎导出\nexport * from './core/BuffSystem'\nexport * from './core/BuffScriptRegistry'\nexport * from './core/BuffScriptLoader'\nexport * from './core/ModifierStack'\nexport * from './core/BuffContext'\nexport * from './core/BuffErrorBoundary'\nexport { GameBattleSystem as BattleSystem } from './core/BattleSystem'\n\n// 类型定义导出\nexport * from './types/buff'\nexport * from './types/character'\nexport * from './types/modifier'\nexport * from './types/enemy'\nexport * from './types/battle'\n\n// 工具函数导出\nexport * from './utils/logger'\nexport * from './utils/perf-monitor'\nexport * from './utils/object-pool'\nexport * from './utils/schema-validator'\n\n// 业务脚本导出\nexport * from './scripts'\n\n// 模块初始化函数\nexport async function initializeBuffSystem(): Promise<void> {\n  try {\n    // 加载所有 Buff 脚本\n    const { BuffScriptLoader } = await import('./core/BuffScriptLoader')\n    await BuffScriptLoader.getInstance().loadScripts()\n\n    console.log('Buff system initialized successfully')\n  } catch (error) {\n    console.error('Failed to initialize buff system:', error)\n  }\n}\n"],"names":["Logger","config","__publicField","level","levels","message","data","formatted","prefix","logger","_BuffScriptRegistry","scriptId","factory","metadata","entry","e","entries","BuffScriptRegistry","BuffContext","characterId","instanceId","key","value","attribute","type","BuffSystem","character","eventName","ModifierStack","buffInstanceId","stack","filtered","modifier","baseValue","modifiers","result","additiveSum","multiplicativeSum","allModifiers","count","BuffErrorBoundary","fn","error","maxRetries","retries","_BuffSystem","reactive","buffId","script","context","buffInstance","instance","deltaTime","toRemove","instances","_BuffScriptLoader","MountainGodBuff","MountainGodBuff$1","PoisonDebuff","PoisonDebuff$1","BerserkBuff","BerserkBuff$1","HealOverTime","HealOverTime$1","ShieldBuff","ShieldBuff$1","registry","id","BuffScriptLoader","BaseBattleAI","battleState","participant","battleAnalysis","skillId","skillError","attackError","allies","p","enemies","teamHealth","sum","teamMaxHealth","teamHealthPercent","highestThreatEnemy","max","enemy","threat","needsHealing","_participant","targetsWithThreat","target","a","b","_battleState","healthPercent","energyPercent","energy","maxEnergy","analysis","skills","healSkill","s","damageSkill","smallSkill","ultimateSkill","skill","targetId","action","CharacterAI","attackSkills","EnemyAI","characters","BattleAIFactory","BaseBattleParticipant","amount","damage","healAmount","originalHealth","SimpleBattleCharacter","attributes","buffs","index","SimpleBattleEnemy","stats","activeSkills","enemyCurrentHealth","enemyMaxHealth","_GameBattleSystem","participantsInfo","battleId","participants","turnOrder","info","aiInstances","ai","battleData","battle","currentParticipantId","defaultAi","aliveCharacters","aliveEnemies","source","energyCost","actualDamage","actualHeal","winner","participantId","GameBattleSystem","PerformanceMonitor","name","start","duration","metric","perfMonitor","measure","ObjectPool","options","obj","i","createBuffContextPool","SchemaValidator","schema","errors","path","requiredField","propertySchema","schemaValidator","BaseBuffScript","defaultValue","_a","BuffScriptUtils","attacker","defender","baseDamage","isCritical","attack","defense","critDmg","baseHealing","maxHP","healing","maxHealing","condition","_b","min","baseDuration","scaleFactor","ms","minutes","seconds","remaining","maxStacks","attackBonus","defenseBonus","elapsed","regeneration","refreshBonus","BUFF_ID","_deltaTime","lastDamageTime","damageInterval","damageMultiplier","stacks","currentDamage","selfDamage","critRateBonus","healInterval","lastHealTime","healingBonus","currentHealing","baseShield","shieldScale","shieldValue","remainingShield","shieldRegen","currentShield","maxShield","newShield","newMaxShield","buffScripts","initializeBuffSystem","BuffScriptLoader$1"],"mappings":"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"}